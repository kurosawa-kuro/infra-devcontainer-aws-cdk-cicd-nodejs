<%- contentFor('body') %>
<h1>投稿一覧</h1>

<div class="post-form">
    <h3>投稿フォーム</h3>
    <form action="/microposts" method="POST" enctype="multipart/form-data">
        <div>
            <input type="text" name="title" placeholder="投稿内容を入力" required>
        </div>
        <div>
            <input type="file" name="image" accept="image/*" onchange="previewImage(this)">
            <img id="preview" class="image-preview">
        </div>
        <button type="submit">投稿</button>
    </form>
</div>

<h3>投稿一覧</h3>
<ul class="posts">
    <% microposts.forEach(post => { %>
        <li class="post-item">
            <div class="post-title"><%= post.title %></div>
            <% if (post.imageUrl) { %>
                <div class="post-image-container">
                    <img src="<%= post.imageUrl %>" 
                         alt="投稿画像" 
                         class="post-image"
                         loading="lazy">
                </div>
            <% } %>
            <div class="post-date">
                <%= new Date(post.createdAt).toLocaleString('ja-JP') %>
            </div>
        </li>
    <% }); %>
</ul>

<script>
    function previewImage(input) {
        const preview = document.getElementById('preview');
        if (input.files?.[0]) {
            const reader = new FileReader();
            reader.onload = e => {
                preview.style.display = 'block';
                preview.src = e.target.result;
            };
            reader.readAsDataURL(input.files[0]);
        } else {
            preview.style.display = 'none';
            preview.src = '';
        }
    }
</script> 