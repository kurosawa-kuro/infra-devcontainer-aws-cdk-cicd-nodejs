<%- contentFor('body') %>
<div class="max-w-5xl mx-auto">
    <div class="mb-12">
        <h1 class="text-4xl font-bold mb-4">投稿一覧</h1>
        <p class="text-text text-lg">画像付きの投稿を共有できます</p>
    </div>

    <div class="grid gap-6">
        <div class="section">
            <h2 class="text-2xl font-semibold mb-6">投稿フォーム</h2>
            <form action="/microposts" method="POST" enctype="multipart/form-data" class="space-y-6">
                <div>
                    <label for="title" class="block text-sm font-medium text-text-dark mb-2">
                        投稿内容
                    </label>
                    <input type="text" 
                           id="title"
                           name="title" 
                           placeholder="投稿内容を入力" 
                           required
                           class="input-text">
                </div>
                <div>
                    <label for="image" class="block text-sm font-medium text-text-dark mb-2">
                        画像
                    </label>
                    <div class="space-y-4">
                        <input type="file" 
                               id="image"
                               name="image" 
                               accept="image/*" 
                               onchange="previewImage(this)"
                               class="block w-full text-sm text-text
                                      file:mr-4 file:py-2 file:px-4
                                      file:rounded-lg file:border-0
                                      file:text-sm file:font-semibold
                                      file:bg-primary file:text-white
                                      hover:file:bg-opacity-90
                                      file:cursor-pointer">
                        <img id="preview" class="hidden max-w-sm rounded-lg border border-border">
                    </div>
                </div>
                <div class="flex justify-end">
                    <button type="submit" 
                            class="btn-primary">
                        投稿する
                    </button>
                </div>
            </form>
        </div>

        <div class="section">
            <h2 class="text-2xl font-semibold mb-6">投稿一覧</h2>
            <div class="grid gap-6">
                <% microposts.forEach(post => { %>
                    <div class="card">
                        <div class="space-y-4">
                            <div class="text-lg"><%= post.title %></div>
                            <% if (post.imageUrl) { %>
                                <div class="bg-bg p-4 rounded-lg">
                                    <img src="<%= post.imageUrl %>" 
                                         alt="投稿画像" 
                                         class="max-w-full h-auto rounded-lg mx-auto"
                                         loading="lazy">
                                </div>
                            <% } %>
                            <div class="flex items-center justify-between text-text text-sm">
                                <div>
                                    <%= new Date(post.createdAt).toLocaleString('ja-JP') %>
                                </div>
                                <div class="flex items-center gap-2">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                    </svg>
                                    <%= new Date(post.createdAt).toLocaleTimeString('ja-JP') %>
                                </div>
                            </div>
                        </div>
                    </div>
                <% }); %>
            </div>
        </div>
    </div>
</div>

<script>
    function previewImage(input) {
        const preview = document.getElementById('preview');
        if (input.files?.[0]) {
            const reader = new FileReader();
            reader.onload = e => {
                preview.classList.remove('hidden');
                preview.src = e.target.result;
            };
            reader.readAsDataURL(input.files[0]);
        } else {
            preview.classList.add('hidden');
            preview.src = '';
        }
    }
</script> 