<%- contentFor('body') %>
<h1>システム状態</h1>

<ul class="feature-list">
    <li>データベース接続確認</li>
    <li>CRUD操作の実装</li>
    <li>AWS S3への画像アップロード</li>
    <li>PostgreSQLとPrisma</li>
    <li class="pending">認証・認可 (実装予定)</li>
</ul>

<div class="status-panel">
    <h3>システム状態</h3>
    <div class="status-check">
        <button onclick="checkHealth()">ヘルスチェック実行</button>
        <span id="last-check"></span>
    </div>
    <p>API状態: <span id="api-health">未確認</span></p>
    <p>データベース状態: <span id="db-health">未確認</span></p>
</div>

<script>
    async function checkHealth() {
        const button = document.querySelector('.status-check button');
        button.disabled = true;
        
        try {
            const [apiRes, dbRes] = await Promise.all([
                fetch('/health'),
                fetch('/health-db')
            ]);

            const [apiData, dbData] = await Promise.all([
                apiRes.json(),
                dbRes.json()
            ]);

            updateStatus('api-health', apiData.status === 'healthy');
            updateStatus('db-health', dbData.status === 'healthy');
            
            document.getElementById('last-check').textContent = 
                `最終確認: ${new Date().toLocaleString('ja-JP')}`;

        } catch (error) {
            console.error('ヘルスチェックエラー:', error);
            updateStatus('api-health', false);
            updateStatus('db-health', false);
        } finally {
            button.disabled = false;
        }
    }

    function updateStatus(elementId, isHealthy) {
        const element = document.getElementById(elementId);
        element.textContent = isHealthy ? '正常' : '異常';
        element.style.color = isHealthy ? 'green' : 'red';
    }
</script> 