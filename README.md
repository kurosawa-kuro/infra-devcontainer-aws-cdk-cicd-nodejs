# Project Name


## デプロイ

1. 初期セットアップ
```bash
# 必要なパッケージのインストール
sudo dnf update -y
sudo dnf install -y git nodejs npm

# pm2のグローバルインストール
sudo npm install -g pm2

# アプリケーションディレクトリの作成
sudo mkdir -p /home/ec2-user/app
sudo chown -R ec2-user:ec2-user /home/ec2-user/app
```

2. アプリケーションのデプロイ
```bash
# Git Clone
cd /home/ec2-user/app
git clone https://github.com/kurosawa-kuro/infra-devcontainer-aws-cdk-cicd-nodejs.git .

# 依存関係のインストール
npm install --production

# 環境変数の設定
cp .env.example .env
vim .env  # 環境変数を設定
```

3. pm2での起動
```bash
# pm2設定と起動
cd /home/ec2-user/app
pm2 start app.js --name "express-app"

# pm2の自動起動設定
pm2 startup
pm2 save
```

## ライセンス

![image](https://github.com/user-attachments/assets/7c5bea60-d337-4a76-8ebd-dc6ee304778f)

# アプリケーション仕様書

## 1. システム概要

本アプリケーションは、ユーザー同士のつながりとコンテンツ共有を可能にするソーシャルプラットフォームです。Express.jsをベースとしたWebアプリケーションとして実装されています。

## 2. 機能構成

### 2.1 認証機能

- ユーザー登録（サインアップ）
  - メールアドレス、パスワード、ユーザー名による登録
  - ユーザー名は半角英数字のみ許可
  - パスワードはbcryptによるハッシュ化
  
- ログイン/ログアウト
  - Passport.jsによるローカル認証
  - セッションベースの認証管理
  - セキュアなクッキー設定（本番環境ではSecure属性有効）

### 2.2 ユーザープロフィール機能

- プロフィール情報
  - 基本情報：ユーザー名、メールアドレス
  - 追加情報：自己紹介、場所、ウェブサイト、生年月日
  - アバター画像（デフォルトアバターあり）
  
- プロフィール管理
  - プロフィール情報の編集
  - アバター画像のアップロード
  - 自身のプロフィールのみ編集可能（管理者は他ユーザーも可）

### 2.3 投稿（Micropost）機能

- 投稿作成
  - テキストコンテンツ
  - 画像添付機能
  - カテゴリー分類
  
- 投稿表示
  - タイムライン表示
  - ユーザーごとの投稿一覧
  - カテゴリーごとの投稿一覧

### 2.4 ソーシャル機能

- フォロー/フォロワー管理
  - ユーザーのフォロー
  - フォロー解除
  - フォロー/フォロワー一覧表示
  - フォロー数・フォロワー数の表示

### 2.5 カテゴリー機能

- カテゴリー管理
  - 投稿のカテゴリー分類
  - カテゴリー一覧表示
  - カテゴリーごとの投稿一覧

### 2.6 管理機能

- ユーザー管理
  - ユーザー一覧表示
  - ユーザー詳細情報の閲覧
  - ユーザーロールの管理
  
- システム管理
  - システムヘルスチェック
  - データベース状態監視
  - 統計情報の表示（総ユーザー数、総投稿数など）

## 3. ロール管理

以下のユーザーロールが実装されています：
- 一般ユーザー（user）
- 管理者（admin）
- 読み取り専用管理者（read-only-admin）

## 4. セキュリティ機能

- 認証・認可
  - ルートごとの適切な認証チェック
  - 管理者専用ルートの保護
  - CSRF対策
  
- パスワードセキュリティ
  - bcryptによるハッシュ化
  - パスワード確認機能

## 5. ファイル管理

- ローカルストレージとS3の両対応
  - 画像アップロード（投稿、アバター）
  - 環境に応じた適切なストレージ選択
  
- ログ管理
  - ログのローテーション
  - S3へのログアップロード
  - 古いログの自動クリーンアップ（7日以上経過）

## 6. 開発支援機能

- クイックログイン機能（開発環境のみ）
- システムメタデータの表示
- 最近のユーザーと投稿の表示
- ヘルスチェックエンドポイント

## 7. データベース設計

### 主要なテーブル
- User：ユーザー基本情報
- UserProfile：詳細プロフィール情報
- Micropost：投稿情報
- Category：カテゴリー情報
- Follow：フォロー関係
- Role：ロール定義
- UserRole：ユーザーとロールの関連付け

### リレーション
- User-UserProfile：1対1
- User-Micropost：1対多
- User-Follow：多対多（自己参照）
- Micropost-Category：多対多
- User-Role：多対多（UserRole経由）

## 8. エラー処理

- 統一的なエラーハンドリング
- 適切なエラーメッセージの提供
- APIレスポースとWebページでの適切なエラー表示
- ログによるエラー追跡

## 9. 国際化対応

- 日本語メッセージの実装
- 多言語対応の基盤あり（コメントに日本語説明あり）

## 10. 環境対応

- 開発環境と本番環境の設定分離
- 環境変数による設定管理
- クラウド環境（EC2）のメタデータ取得対応